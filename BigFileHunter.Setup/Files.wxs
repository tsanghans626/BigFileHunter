<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <!-- 使用 Files 元素收集所有文件，排除主程序 -->
      <Files Include="!(bindpath.PublishPath)\**">
        <Exclude Files="!(bindpath.PublishPath)\BigFileHunter.exe" />
      </Files>

      <!-- 主程序单独定义（用于快捷方式等） -->
      <Component Id="MainExecutable" Guid="*" >
        <File Id="BigFileHunter.exe"
              Source="!(bindpath.PublishPath)\BigFileHunter.exe"
              KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ShortcutComponents">
      <!-- Start Menu Shortcut -->
      <Component Id="StartMenuShortcut" Guid="*" Directory="ApplicationProgramsFolder" >
        <Shortcut Id="StartMenuShortcut"
                  Name="BigFileHunter"
                  Description="Scan directories to identify disk usage patterns"
                  Target="[#BigFileHunter.exe]"
                  WorkingDirectory="INSTALLFOLDER" />
        <RegistryValue Root="HKCU"
                       Key="Software\BigFileHunter"
                       Name="StartMenuShortcut"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
      </Component>

      <!-- Desktop Shortcut -->
      <Component Id="DesktopShortcut" Guid="*" Directory="DesktopFolder" >
        <Shortcut Id="DesktopShortcut"
                  Name="BigFileHunter"
                  Description="Scan directories to identify disk usage patterns"
                  Target="[#BigFileHunter.exe]"
                  WorkingDirectory="INSTALLFOLDER" />
        <RegistryValue Root="HKCU"
                       Key="Software\BigFileHunter"
                       Name="DesktopShortcut"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
      </Component>

      <!-- Uninstall Shortcut -->
      <Component Id="UninstallShortcut" Guid="*" Directory="ApplicationProgramsFolder" >
        <Shortcut Id="UninstallShortcut"
                  Name="Uninstall BigFileHunter"
                  Description="Remove BigFileHunter from your computer"
                  Target="[SystemFolder]msiexec.exe"
                  Arguments="/x [ProductCode]"
                  WorkingDirectory="SystemFolder" />
        <RegistryValue Root="HKCU"
                       Key="Software\BigFileHunter"
                       Name="UninstallShortcut"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
