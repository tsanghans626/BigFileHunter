<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="BigFileHunter"
           Manufacturer="BigFileHunter"
           Version="$(var.Version)"
           UpgradeCode="01dde612-e825-4dd2-84bd-1a61a0f48813"
           Language="1033">

    <MediaTemplate EmbedCab="yes" />

    <!-- Add UI for installation (disabled for local builds, enabled in GitHub workflow) -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- UI enabled for local builds (requires WixToolset.UI.wixext) -->
    <ui:WixUI Id="WixUI_InstallDir" />

    <!-- Add MajorUpgrade for version handling -->
    <MajorUpgrade DowngradeErrorMessage="A newer version of BigFileHunter is already installed." />

    <!-- Installation directory structure - platform-specific -->
    <?if $(sys.BUILDARCH) = x86 ?>
        <StandardDirectory Id="ProgramFilesFolder">
          <Directory Id="INSTALLFOLDER" Name="BigFileHunter" />
        </StandardDirectory>
    <?else ?>
        <StandardDirectory Id="ProgramFiles64Folder">
          <Directory Id="INSTALLFOLDER" Name="BigFileHunter" />
        </StandardDirectory>
    <?endif ?>

    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="BigFileHunter"/>
    </StandardDirectory>

    <StandardDirectory Id="DesktopFolder" />

    <!-- Features for installation -->
    <Feature Id="ProductFeature" Title="BigFileHunter" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentGroupRef Id="ShortcutComponents" />
    </Feature>
  </Package>

  <!-- Detect same version installation and block it -->
  <Fragment>
    <Upgrade Id="01dde612-e825-4dd2-84bd-1a61a0f48813">
      <UpgradeVersion Minimum="$(var.Version)"
                      Maximum="$(var.Version)"
                      Property="SAME_VERSION_DETECTED"
                      IncludeMinimum="yes"
                      IncludeMaximum="yes" />
    </Upgrade>

    <Launch Condition="NOT SAME_VERSION_DETECTED"
           Message="BigFileHunter v$(var.Version) is already installed. Please uninstall the existing version first." />
  </Fragment>
</Wix>
